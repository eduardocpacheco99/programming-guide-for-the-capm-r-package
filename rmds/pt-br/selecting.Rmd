```{r knitsetup, echo=FALSE, results='hide', warning=FALSE, message=FALSE, cache=FALSE}
library(knitr)
opts_knit$set(base.dir='./')
opts_chunk$set(prompt=TRUE, comment='', fig.path='figures/')
options(width == 66)
```

Com o pacote `capm` é possível implementar os siguientes desenhos amostrais:  
* Amostragem aleatória sistemática  
* Amostragem aleatória estratificada  
* Amostragem aleatória complexa  (disenhos por conglomerados em dois estágios com selecção probabilítstica proporcional ao tamanho)

Implementemos un desenho por conglomerados en dois estágio que é o mais desafiante mas tambiem o mais apropriado para algumas situações (cidades grandes). O arquivo `psu.ssu.csv` contém dados da cidade de Santos, Brasil. Os dados foram obtidos no Instituto Brasileiro de Geografia e Estatística ([IBGE](http://ibge.gov.br)). A primeira colmna tem identificadores únicos dos setores censitários, a nossas Unidades Primárias de Amostragem (UPA). A segunda coluna contém o número de residências eM cada UPA. As residencias as nossas Unidades Secundárias de Amostragem (USA), que ao mesmo tempo são a medida do tamanho das UPA.


Carreguemos o paquete e importemos el arquivo.

```{r}
library(capm)
psu.ssu <- read.csv(file = 'psu.ssu.csv')
```

Podemos ver que há 652 UPA e as seis primerias linhas nós dão uma ideia dos dados.

```{r}
nrow(psu.ssu); head(psu.ssu)
```

Todas as UPA são aparentemente iguais devido à notação científica. Os identificadores devem ser únicos para cada UPA e para verificar esse requerimento, podemos mudar a forma de impressão ou verificar que o número de diferentes identificadores é igual ao número de UPA.

```{r}
print(head(psu.ssu), digits = 15)
length(unique(psu.ssu[ , 1]))
```

O arquivo contém exactamente a información que precisamos para amostrar UPA com probabilidad proporcional ao tamaño (PPT) e com resposição. Se o argumento `write` de `SamplePPS` é definidio como `TRUE`, as UPA selecionadas serão salvas em um arquivo "csv" que pode ser visto em um software de folhas de cálculo. O resultado terá tantas linhas como UPA selecionadas. Lembremos que uma UPA pode ser seleccionada mais de uma vez porque a amostragem é com resposição.  

Se usamos `set.seed(algun_numero)`, a seguiente pseudo amostra será sempre a mesma. Neste gua usaremos `set.seed(4)` para que todos podamos reproduzir exatamente todos os exemplos. Não entanto, em aplicaciones reaies no devemos usar `set.seed`.

```{r}
set.seed(4)
pilot.psu <- SamplePPS(psu.ssu = psu.ssu,
                       psu = 10,
                       write = FALSE)
```

Ao inspeccionar o objeto que acabamos de criar podemos ver que a "clase" dos identificadores das UPA foi convertida para `character`. Isto quer dizer que os identificadores agora são representados como texto, no como números.

```{r}
str(pilot.psu, vec.len = 1)
head(pilot.psu)
```

A seleção das USA é tão simples como a selecção anterior. O resultado terá tantas linhas como USA selecionadas em cada UPA e tantas colunas como UPA selecionadas.

```{r}
set.seed(4)
pilot.ssu <- SampleSystematic(
    psu.ssu = pilot.psu,
    su = 5, write = FALSE)
```

Vejamos as primeiras dos colunas para ter uma ideia.

```{r}
head(pilot.ssu[ , 1:2])
```
